<div class="container">
  <h1 class="my-4">Dashboard</h1>
  
  <div class="row">
    <div class="col-md-8">
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-user mr-2"></i> Your Artists
          </h5>
        </div>
        <div class="card-body">
          <% if @artists.present? %>
            <div class="list-group">
              <% @artists.each do |artist| %>
                <%= link_to artist_path(artist), class: "list-group-item list-group-item-action d-flex justify-content-between align-items-center" do %>
                  <div>
                    <h6 class="mb-1"><%= artist.name %></h6>
                    <small>
                      <span class="badge bg-primary">Skill: <%= artist.skill %></span>
                      <span class="badge bg-success">Popularity: <%= artist.popularity %></span>
                      <span class="badge bg-warning text-dark">Energy: <%= artist.energy %></span>
                    </small>
                  </div>
                  <div class="text-end">
                    <% if artist.upcoming_performances.any? %>
                      <span class="badge bg-info">Next show: <%= artist.upcoming_performances.first.scheduled_for.strftime("%b %d") %></span>
                    <% end %>
                  </div>
                <% end %>
              <% end %>
            </div>
          <% else %>
            <div class="alert alert-info">
              You don't have any artists yet.
              <%= link_to "Create your first artist", new_artist_path, class: "alert-link" %>
            </div>
          <% end %>
        </div>
        <div class="card-footer">
          <%= link_to "View All Artists", artists_path, class: "btn btn-sm btn-outline-primary" %>
          <%= link_to "Create New Artist", new_artist_path, class: "btn btn-sm btn-primary" %>
        </div>
      </div>
      
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-calendar-alt mr-2"></i> Upcoming Performances
          </h5>
        </div>
        <div class="card-body">
          <% if @upcoming_performances.present? %>
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Artist</th>
                    <th>Venue</th>
                    <th>Date</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody>
                  <% @upcoming_performances.each do |performance| %>
                    <tr>
                      <td><%= link_to performance.artist.name, artist_path(performance.artist) %></td>
                      <td><%= performance.venue.name %></td>
                      <td><%= performance.scheduled_for.strftime("%b %d, %Y") %></td>
                      <td><span class="badge bg-<%= performance.status == 'scheduled' ? 'success' : 'warning' %>"><%= performance.status.humanize %></span></td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          <% else %>
            <div class="alert alert-info">
              No upcoming performances scheduled.
              <%= link_to "Book a performance", new_performance_path, class: "alert-link" %>
            </div>
          <% end %>
        </div>
        <div class="card-footer">
          <%= link_to "View All Performances", performances_path, class: "btn btn-sm btn-outline-primary" %>
          <%= link_to "Book Performance", new_performance_path, class: "btn btn-sm btn-primary" %>
        </div>
      </div>
      
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-history mr-2"></i> Recent Performances
          </h5>
        </div>
        <div class="card-body">
          <% if @past_performances.present? %>
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Artist</th>
                    <th>Venue</th>
                    <th>Date</th>
                    <th>Attendance</th>
                    <th>Revenue</th>
                  </tr>
                </thead>
                <tbody>
                  <% @past_performances.each do |performance| %>
                    <tr>
                      <td><%= link_to performance.artist.name, artist_path(performance.artist) %></td>
                      <td><%= performance.venue.name %></td>
                      <td><%= performance.scheduled_for.strftime("%b %d, %Y") %></td>
                      <td><%= performance.attendance || 'N/A' %></td>
                      <td><%= number_to_currency(performance.net_revenue) if performance.net_revenue %></td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          <% else %>
            <div class="alert alert-info">
              No past performances yet.
            </div>
          <% end %>
        </div>
      </div>
    </div>
    
    <div class="col-md-4">
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-user-circle mr-2"></i> Manager Status
          </h5>
        </div>
        <div class="card-body">
          <h4><%= current_manager.name %></h4>
          <div class="mb-3">
            <div class="d-flex justify-content-between mb-1">
              <span>Level: <%= current_manager.level %></span>
              <span><%= current_manager.xp %> XP</span>
            </div>
            <div class="progress">
              <% xp_percentage = current_manager.level < 10 ? (current_manager.xp / (current_manager.level * 1000.0) * 100).round : 100 %>
              <div class="progress-bar bg-success" role="progressbar" style="width: <%= xp_percentage %>%" 
                   aria-valuenow="<%= xp_percentage %>" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
          </div>
          
          <p class="card-text">
            <strong>Account Balance:</strong> <%= number_to_currency(current_manager.budget) %><br>
            <strong>Active Season:</strong> <%= @active_season.name %><br>
            <strong>Artist Limit:</strong> <%= current_manager.level * 2 %>
          </p>
        </div>
      </div>
      
      <%= render 'venue_statistics' %>
      <%= render 'trending_venues' %>
    </div>
  </div>
</div> 